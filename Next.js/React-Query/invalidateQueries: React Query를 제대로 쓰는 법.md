# refreshMembers vs invalidateQueries: React Queryë¥¼ ì œëŒ€ë¡œ ì“°ëŠ” ë²•

## ë“¤ì–´ê°€ë©°

React Queryë¥¼ ì‚¬ìš©í•˜ë‹¤ ë³´ë©´, ë‹¤ìŒ ë‘ ë°©ì‹ ì¤‘ ì–´ë–¤ ê²ƒì„ ì¨ì•¼ í• ì§€ ê³ ë¯¼ì´ ëœë‹¤.

```ts
// 1. ì§ì ‘ ë‹¤ì‹œ ë°ì´í„°ë¥¼ fetchí•´ì„œ ìƒíƒœì— ë„£ê¸°
const refreshMembers = async () => {
  const newMembers = await fetchMembers();
  setMembers(newMembers);
};

// 2. React Queryì—ê²Œ ìºì‹œë¥¼ ë¬´íš¨í™”ì‹œí‚¤ê³  refetchë¥¼ ìœ ë„í•˜ê¸°
await queryClient.invalidateQueries({ queryKey: ["memberList"] });
```

ë‹¨ìˆœíˆ ë³´ë©´ ë‘˜ ë‹¤ "ë°ì´í„°ë¥¼ ë‹¤ì‹œ ê°€ì ¸ì˜¨ë‹¤"ëŠ” ê³µí†µì ì„ ê°€ì§€ì§€ë§Œ, **React Queryì˜ ì² í•™ê³¼ ì´ì ** ì„ ì‚´ë¦¬ê¸° ìœ„í•´ì„  2ë²ˆ ë°©ì‹ì´ í›¨ì”¬ ê¶Œì¥ëœë‹¤.

---

## ğŸ§© 1. refreshMembers: ì „í†µì ì¸ ë°©ì‹

ì´ ë°©ì‹ì€ í”íˆ `useState()` ë¡œ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ë˜ ì‹œì ˆì˜ ì „í†µì ì¸ ì ‘ê·¼ ë°©ì‹ì´ë‹¤.

```ts
const [members, setMembers] = useState<MemberType[]>([]);

const refreshMembers = async () => {
  const newMembers = await fetchMembers();
  setMembers(newMembers); // ì§ì ‘ ìƒíƒœ ê°±ì‹ 
};
```

### ì¥ì 

- ì´í•´í•˜ê¸° ì‰½ê³  ì¦‰ì‹œ ê²¨ê³¼ë¥¼ ë‹¤ë£° ìˆ˜ ìˆë‹¤.

### ë‹¨ì 

- ìƒíƒœê°€ ë¡œì»¬ì—ë§Œ ì¡´ì¬ -> ë‹¤ë¥¸ ì»´í¬ë„ŒíŠ¸ì—ì„œ ê³µìœ  ë¶ˆê°€
- ì¤‘ë³µ ìƒíƒœ ë°œìƒ ìœ„í—˜ (React Query ìºì‹œì™€ ë³„ë„ë¡œ ì¡´ì¬)
- ë¦¬íŒ©í„°ë§/ì¶”ì  ì–´ë ¤ì›€: ëˆ„ê°€ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ëŠ”ì§€ ì¶”ì í•´ì•¼ í•¨
- ìºì‹œë¥¼ í™œìš©í•˜ì§€ ëª»í•¨ -> ë¶ˆí•„ìš”í•œ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ ë°œìƒ

---

## âš¡ 2. invalidateQueries: React Query ë°©ì‹

React QueryëŠ” ë°ì´í„°ë¥¼ ì „ì—­ì ìœ¼ë¡œ ìºì‹±í•œë‹¤.
ì¦‰, `['memberList']` ë¼ëŠ” ì¿¼ë¦¬ í‚¤ë¡œ ê´€ë¦¬ë˜ê³  ìˆë‹¤ë©´, ì´ ìºì‹œë¥¼ ë¬´íš¨í™”(invalidate)í•˜ëŠ” ê²ƒë§Œìœ¼ë¡œ ìë™ìœ¼ë¡œ ë‹¤ì‹œ fetchëœë‹¤.

```ts
const queryClient = useQueryClient();

await queryClient.invalidateQueries({ queryKey: ["memberList"] });
```

### ì¥ì 

- ì „ì—­ ìºì‹œì™€ ì¼ê´€ì„± ìœ ì§€ (ì–´ë””ì—ì„œë‚˜ ê°™ì€ ë°ì´í„°)
- ìë™ìœ¼ë¡œ `useQuery()`ê°€ ì‹¤í–‰ë˜ë¯€ë¡œ, ì½”ë“œ ì¤‘ë³µì´ ì¤„ì–´ë“¦
- loading, error, stale ìƒíƒœ ë“± React Queryì˜ ìƒíƒœ ê´€ë¦¬ ê¸°ëŠ¥ì„ ê·¸ëŒ€ë¡œ í™œìš© ê°€ëŠ¥
- ë¹„ë™ê¸° íë¦„ì´ ê¹”ë”í•´ì§€ê³ , ìœ ì§€ë³´ìˆ˜ê°€ ì‰¬ì›€

### ë‹¨ì 

- ì²˜ìŒì—” ì•½ê°„ ê°œë…ì´ ìƒì†Œí•  ìˆ˜ ìˆìŒ

---

## ğŸ¯ React Queryì˜ í•µì‹¬ ì² í•™

> **"ë°ì´í„°ëŠ” ìƒíƒœê°€ ì•„ë‹ˆë‹¤. ì„œë²„ ìƒíƒœëŠ” ì¿¼ë¦¬ í‚¤ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ê´€ë¦¬í•œë‹¤."**
> React Query ëŠ” ìƒíƒœ(state)ë¥¼ ì§ì ‘ ê´€ë¦¬í•˜ì§€ ì•ŠëŠ”ë‹¤.

ëŒ€ì‹  ì„œë²„ ìƒíƒœ(server state)ë¥¼ ì¿¼ë¦¬ í‚¤(`queryKey`) ê¸°ë°˜ìœ¼ë¡œ ìºì‹±í•˜ê³ , ì´ë¥¼ ìë™ìœ¼ë¡œ refetch/ invalidate/ update í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì•±ì„ êµ¬ìƒí•œë‹¤.

---

## ì˜ˆì‹œ ë¹„êµ

| í•­ëª©                  | `refreshMembers` (ìˆ˜ë™) | `invalidateQueries` (React Query) |
| --------------------- | ----------------------- | --------------------------------- |
| ìƒíƒœ ê´€ë¦¬             | `useState` ì§ì ‘         | `useQuery` ìë™                   |
| ì¤‘ë³µ ìœ„í—˜             | O (state vs cache)      | X                                 |
| React Query ìºì‹œ í™œìš© | âŒ ëª»í•¨                 | âœ… ê°€ëŠ¥                           |
| ì½”ë“œ ìœ„ì¹˜ ì¶”ì         | ì–´ë µë‹¤                  | í•œ ì¿¼ë¦¬ í‚¤ë¡œ í†µí•©                 |
| ë¡œë”©/ì—ëŸ¬ ì²˜ë¦¬        | ì§ì ‘ êµ¬í˜„               | React Queryê°€ ì œê³µ                |
| ìœ ì§€ë³´ìˆ˜              | ì–´ë µë‹¤                  | ì‰½ë‹¤ (í†µí•© ê´€ë¦¬)                  |

---

### ì–¸ì œ `invalidateQueries` ë¥¼ ì¨ì•¼ í• ê¹Œ?

- ì„œë²„ ë°ì´í„°ë¥¼ ë³€ê²½(Mutation)í•œ í›„,
- í•´ë‹¹ ë°ì´í„°ê°€ ì‚¬ìš©ë˜ëŠ” ê³³ì´ `useQuery()`ë¡œ fetch ë˜ê³  ìˆë‹¤ë©´,
- ë¬´ì¡°ê±´ `invalidateQueries` ë¥¼ ì¨ì•¼ í•œë‹¤.

```ts
await changeMemberRole(id, newRole);
await queryClient.invalidateQueries({ queryKey: ["memberList"] });
```

## ê²°ë¡ : React Query ì˜ í˜ì„ ì œëŒ€ë¡œ ì“°ê³  ì‹¶ë‹¤ë©´

> "fetch â†’ setState â†’ ìƒíƒœ ê°±ì‹ " ëŒ€ì‹ 
> "invalidateQueries â†’ ìë™ refetch" íŒ¨í„´ìœ¼ë¡œ ì˜®ê²¨ê°€ë¼.

ì´ê²ƒì´ React Queryê°€ ì˜ë„í•œ íš¨ìœ¨ì ì¸ ë°ì´í„° íë¦„ ë°©ì‹ì´ë‹¤.

### ğŸ“Œ ë³´ë„ˆìŠ¤ íŒ: ìºì‹œ ì§ì ‘ ìˆ˜ì •ë„ ê°€ëŠ¥

```ts
queryClient.setQueryData(["memberList"], (old) => {
  return [...old, newMember];
});
```

â†’ ì´ëŸ° ì‹ìœ¼ë¡œ ìºì‹œë¥¼ ì§ì ‘ ì¡°ì‘í•˜ëŠ” ê³ ê¸‰ íŒ¨í„´ë„ ê°€ëŠ¥í•˜ì§€ë§Œ,
ê¸°ë³¸ì ìœ¼ë¡œëŠ” invalidateQueries()ê°€ ê°€ì¥ ì•ˆì „í•˜ê³  ê¹”ë”í•œ ë°©ë²•ì´ë‹¤.

## ìš”ì•½ í•œ ì¤„

React Queryë¥¼ ì“´ë‹¤ë©´, ë°ì´í„°ë¥¼ ë‹¤ì‹œ ê°€ì ¸ì˜¬ ë• refresh + setState ëŒ€ì‹  invalidateQueriesë¥¼ ì¨ë¼.
ê·¸ë˜ì•¼ ìºì‹œ, ìƒíƒœ, ì»´í¬ë„ŒíŠ¸ê°€ í•˜ë‚˜ë¡œ ì—°ê²°ëœë‹¤.
